<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parabola Pictionary Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .secret-input {
            background-color: #000;
            color: #fff;
            caret-color: white;
            border: 1px solid #333;
            transition: color 0.3s;
        }
        .secret-input.hidden-text {
            color: #000 !important;
        }
        .secret-input:focus {
            outline: none;
            border-color: #555;
        }
        canvas {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        }
        .fw-canvas {
            background: transparent;
            pointer-events: none;
            box-shadow: none;
        }
        .btn-transform {
            transition: all 0.2s;
        }
        .btn-transform:active:not(:disabled) {
            transform: scale(0.95);
        }
        .btn-transform:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .timer-display {
            font-family: 'Courier New', Courier, monospace;
        }
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            opacity: 1;
        }
        
        /* Celebration Animation */
        @keyframes celebrate {
            0% { transform: scale(0.5) rotate(-10deg); opacity: 0; }
            50% { transform: scale(1.2) rotate(5deg); opacity: 1; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        .celebration-badge {
            animation: celebrate 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen font-sans p-4 md:p-8">

    <div class="max-w-6xl mx-auto">
        <header class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
            <div class="text-center md:text-left">
                <h1 class="text-4xl font-bold text-blue-400 mb-1">Parabola Pictionary</h1>
                <p class="text-gray-400">Match the target to score points!</p>
            </div>
            
            <!-- Scoreboard -->
            <div class="flex items-center gap-6 bg-gray-800 p-4 rounded-2xl border border-gray-700 shadow-2xl">
                <div class="text-center">
                    <div class="text-xs uppercase text-red-400 font-black">Red Score</div>
                    <div id="score1" class="text-3xl font-mono font-bold">0</div>
                </div>
                <div class="h-10 w-px bg-gray-700"></div>
                <div class="text-center">
                    <div class="text-xs uppercase text-blue-400 font-black">Blue Score</div>
                    <div id="score2" class="text-3xl font-mono font-bold">0</div>
                </div>
                <button onclick="resetScores()" class="ml-2 p-2 hover:bg-gray-700 rounded-full transition text-gray-500 hover:text-white" title="Reset Scores">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                    </svg>
                </button>
            </div>
        </header>

        <!-- Secret Teacher Input -->
        <div class="bg-gray-800 p-6 rounded-xl border border-gray-700 mb-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-400 mb-1">Target Equation (Vertex Form):</label>
                    <input type="text" id="targetEquation" 
                           placeholder="e.g. y = -2(x-3)^2 + 4"
                           class="secret-input w-full p-3 rounded text-lg font-mono"
                           value="">
                    <p id="visibilityHint" class="text-xs text-gray-400 mt-1 italic">Text is visible now. It will hide when you click "Start Round".</p>
                </div>
                <div class="flex gap-2">
                    <button id="startBtn" onclick="startRound()" class="flex-1 bg-green-600 hover:bg-green-500 px-4 py-3 rounded font-bold transition">
                        Start Round
                    </button>
                    <button id="revealBtn" onclick="revealTarget()" class="flex-1 bg-blue-600 hover:bg-blue-500 px-4 py-3 rounded font-bold transition">
                        Reveal Target
                    </button>
                    <button onclick="resetAll()" class="bg-red-600 hover:bg-red-500 px-4 py-3 rounded font-bold transition">
                        Reset
                    </button>
                </div>
            </div>
            <div id="revealArea" class="mt-4 hidden text-center p-4 bg-gray-700 rounded-lg border-2 border-green-500">
                <span class="text-2xl font-bold text-yellow-400" id="revealedText"></span>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Team 1 -->
            <div id="team1Card" class="bg-gray-800 p-6 rounded-xl border-t-4 border-red-500 shadow-xl relative overflow-hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold text-red-400">Team Red</h2>
                    <div class="text-right">
                        <div id="timer1" class="timer-display text-xl font-bold text-white">00:00.0</div>
                        <span id="eq1" class="text-sm font-mono text-gray-500 italic block h-5">y = x²</span>
                    </div>
                </div>
                
                <div class="relative">
                    <canvas id="canvas1" width="400" height="400" class="w-full h-auto mb-4"></canvas>
                    <canvas id="fwCanvas1" width="400" height="400" class="fw-canvas absolute inset-0 w-full h-auto mb-4"></canvas>
                    <!-- Celebration Overlay -->
                    <div id="celebrate1" class="absolute inset-0 flex items-center justify-center pointer-events-none hidden">
                        <div class="celebration-badge bg-green-500 text-white px-8 py-4 rounded-2xl shadow-2xl border-4 border-white font-black text-4xl transform -rotate-6">
                            CORRECT!
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-3 gap-2">
                    <button onclick="transform(1, 'up')" class="btn-transform team1-btn bg-gray-700 hover:bg-gray-600 p-2 rounded">Up 1</button>
                    <button onclick="transform(1, 'left')" class="btn-transform team1-btn bg-gray-700 hover:bg-gray-600 p-2 rounded">Left 1</button>
                    <div class="flex flex-col gap-1">
                        <label class="text-[10px] uppercase text-gray-500 text-center font-bold">Integer Factor</label>
                        <input type="number" id="factor1" value="2" step="1" min="1" class="team1-btn bg-gray-900 border border-gray-600 rounded p-1 text-center text-white text-sm">
                    </div>
                    <button onclick="transform(1, 'down')" class="btn-transform team1-btn bg-gray-700 hover:bg-gray-600 p-2 rounded">Down 1</button>
                    <button onclick="transform(1, 'right')" class="btn-transform team1-btn bg-gray-700 hover:bg-gray-600 p-2 rounded">Right 1</button>
                    <div class="grid grid-cols-2 gap-1">
                        <button onclick="transform(1, 'stretch')" class="btn-transform team1-btn bg-purple-900/40 hover:bg-purple-800 p-2 rounded border border-purple-700 text-xs">Stretch</button>
                        <button onclick="transform(1, 'compress')" class="btn-transform team1-btn bg-purple-900/40 hover:bg-purple-800 p-2 rounded border border-purple-700 text-xs">Shrink</button>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-2 mt-2">
                    <button onclick="transform(1, 'reflectX')" class="btn-transform team1-btn bg-red-900/50 hover:bg-red-800 p-2 rounded border border-red-700">Reflect X</button>
                    <button id="lock1" onclick="lockIn(1)" class="btn-transform team1-btn bg-white text-black font-bold p-2 rounded hover:bg-gray-200">LOCK IN</button>
                </div>
                <div id="lockOverlay1" class="absolute inset-0 bg-red-900/20 pointer-events-none hidden flex items-center justify-center">
                    <div class="bg-red-600 text-white px-6 py-2 rounded-full font-black text-2xl rotate-12 shadow-2xl uppercase tracking-widest">Locked In</div>
                </div>
            </div>

            <!-- Team 2 -->
            <div id="team2Card" class="bg-gray-800 p-6 rounded-xl border-t-4 border-blue-500 shadow-xl relative overflow-hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold text-blue-400">Team Blue</h2>
                    <div class="text-right">
                        <div id="timer2" class="timer-display text-xl font-bold text-white">00:00.0</div>
                        <span id="eq2" class="text-sm font-mono text-gray-500 italic block h-5">y = x²</span>
                    </div>
                </div>
                
                <div class="relative">
                    <canvas id="canvas2" width="400" height="400" class="w-full h-auto mb-4"></canvas>
                    <canvas id="fwCanvas2" width="400" height="400" class="fw-canvas absolute inset-0 w-full h-auto mb-4"></canvas>
                    <!-- Celebration Overlay -->
                    <div id="celebrate2" class="absolute inset-0 flex items-center justify-center pointer-events-none hidden">
                        <div class="celebration-badge bg-green-500 text-white px-8 py-4 rounded-2xl shadow-2xl border-4 border-white font-black text-4xl transform rotate-6">
                            CORRECT!
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-3 gap-2">
                    <button onclick="transform(2, 'up')" class="btn-transform team2-btn bg-gray-700 hover:bg-gray-600 p-2 rounded">Up 1</button>
                    <button onclick="transform(2, 'left')" class="btn-transform team2-btn bg-gray-700 hover:bg-gray-600 p-2 rounded">Left 1</button>
                    <div class="flex flex-col gap-1">
                        <label class="text-[10px] uppercase text-gray-500 text-center font-bold">Integer Factor</label>
                        <input type="number" id="factor2" value="2" step="1" min="1" class="team2-btn bg-gray-900 border border-gray-600 rounded p-1 text-center text-white text-sm">
                    </div>
                    <button onclick="transform(2, 'down')" class="btn-transform team2-btn bg-gray-700 hover:bg-gray-600 p-2 rounded">Down 1</button>
                    <button onclick="transform(2, 'right')" class="btn-transform team2-btn bg-gray-700 hover:bg-gray-600 p-2 rounded">Right 1</button>
                    <div class="grid grid-cols-2 gap-1">
                        <button onclick="transform(2, 'stretch')" class="btn-transform team2-btn bg-purple-900/40 hover:bg-purple-800 p-2 rounded border border-purple-700 text-xs">Stretch</button>
                        <button onclick="transform(2, 'compress')" class="btn-transform team2-btn bg-purple-900/40 hover:bg-purple-800 p-2 rounded border border-purple-700 text-xs">Shrink</button>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-2 mt-2">
                    <button onclick="transform(2, 'reflectX')" class="btn-transform team2-btn bg-blue-900/50 hover:bg-blue-800 p-2 rounded border border-blue-700">Reflect X</button>
                    <button id="lock2" onclick="lockIn(2)" class="btn-transform team2-btn bg-white text-black font-bold p-2 rounded hover:bg-gray-200">LOCK IN</button>
                </div>
                <div id="lockOverlay2" class="absolute inset-0 bg-blue-900/20 pointer-events-none hidden flex items-center justify-center">
                    <div class="bg-blue-600 text-white px-6 py-2 rounded-full font-black text-2xl -rotate-12 shadow-2xl uppercase tracking-widest">Locked In</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const state = {
            1: { h: 0, k: 0, a: 1, locked: false, startTime: null, finalTime: null, score: 0 },
            2: { h: 0, k: 0, a: 1, locked: false, startTime: null, finalTime: null, score: 0 },
            target: { h: 0, k: 0, a: 1, active: false },
            roundActive: false
        };

        const gridScale = 20;
        let timerInterval;

        // Fireworks State
        const fwParticles = { 1: [], 2: [] };
        
        class Particle {
            constructor(x, y, color) {
                this.x = x;
                this.y = y;
                this.color = color;
                this.radius = Math.random() * 3 + 1;
                this.velocity = {
                    x: (Math.random() - 0.5) * 8,
                    y: (Math.random() - 0.5) * 8
                };
                this.alpha = 1;
                this.decay = Math.random() * 0.015 + 0.015;
            }

            draw(ctx) {
                ctx.save();
                ctx.globalAlpha = this.alpha;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();
                ctx.restore();
            }

            update() {
                this.velocity.y += 0.05; // gravity
                this.x += this.velocity.x;
                this.y += this.velocity.y;
                this.alpha -= this.decay;
            }
        }

        function launchFireworks(teamNum) {
            const canvas = document.getElementById(`fwCanvas${teamNum}`);
            const colors = teamNum === 1 
                ? ['#ef4444', '#f87171', '#fee2e2', '#ffffff'] 
                : ['#3b82f6', '#60a5fa', '#dbeafe', '#ffffff'];
            
            // Initial burst
            for (let i = 0; i < 100; i++) {
                fwParticles[teamNum].push(new Particle(
                    canvas.width / 2, 
                    canvas.height / 2, 
                    colors[Math.floor(Math.random() * colors.length)]
                ));
            }
        }

        function animateFireworks() {
            [1, 2].forEach(num => {
                const canvas = document.getElementById(`fwCanvas${num}`);
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                fwParticles[num] = fwParticles[num].filter(p => p.alpha > 0);
                fwParticles[num].forEach(p => {
                    p.update();
                    p.draw(ctx);
                });

                // Random small extra pops while celebrating
                if (state.target.active && !document.getElementById(`celebrate${num}`).classList.contains('hidden')) {
                    if (Math.random() < 0.05) {
                        const colors = num === 1 ? ['#ef4444', '#ffffff'] : ['#3b82f6', '#ffffff'];
                        const x = Math.random() * canvas.width;
                        const y = Math.random() * canvas.height;
                        for (let i = 0; i < 15; i++) {
                            fwParticles[num].push(new Particle(x, y, colors[Math.floor(Math.random() * colors.length)]));
                        }
                    }
                }
            });
            requestAnimationFrame(animateFireworks);
        }

        function init() {
            draw(1);
            draw(2);
            disableButtons(1, true);
            disableButtons(2, true);
            requestAnimationFrame(animateFireworks);
        }

        function draw(teamNum) {
            const canvas = document.getElementById(`canvas${teamNum}`);
            const ctx = canvas.getContext('2d');
            const { h, k, a } = state[teamNum];
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;

            // Grid & Axes
            ctx.strokeStyle = '#e5e7eb';
            ctx.lineWidth = 1;
            for(let x = 0; x <= canvas.width; x += gridScale) {
                ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, canvas.height); ctx.stroke();
            }
            for(let y = 0; y <= canvas.height; y += gridScale) {
                ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(canvas.width, y); ctx.stroke();
            }
            ctx.strokeStyle = '#374151'; ctx.lineWidth = 2;
            ctx.beginPath(); ctx.moveTo(centerX, 0); ctx.lineTo(centerX, canvas.height); ctx.stroke();
            ctx.beginPath(); ctx.moveTo(0, centerY); ctx.lineTo(canvas.width, centerY); ctx.stroke();

            // Draw Target Solution (Green Highlighter)
            if (state.target.active) {
                ctx.strokeStyle = 'rgba(34, 197, 94, 0.6)';
                ctx.lineWidth = 12;
                ctx.setLineDash([8, 4]);
                ctx.beginPath();
                for(let x = -10; x <= 10; x += 0.1) {
                    const ty = state.target.a * Math.pow(x - state.target.h, 2) + state.target.k;
                    const txCan = centerX + (x * gridScale);
                    const tyCan = centerY - (ty * gridScale);
                    if(x === -10) ctx.moveTo(txCan, tyCan);
                    else ctx.lineTo(txCan, tyCan);
                }
                ctx.stroke();
                ctx.setLineDash([]);
            }

            // Draw Team Parabola
            ctx.strokeStyle = teamNum === 1 ? '#ef4444' : '#3b82f6';
            ctx.lineWidth = 3;
            ctx.beginPath();
            for(let x = -10; x <= 10; x += 0.1) {
                const y = a * Math.pow(x - h, 2) + k;
                const canvasX = centerX + (x * gridScale);
                const canvasY = centerY - (y * gridScale);
                if(x === -10) ctx.moveTo(canvasX, canvasY);
                else ctx.lineTo(canvasX, canvasY);
            }
            ctx.stroke();

            updateEquationDisplay(teamNum);
        }

        function startRound() {
            if (state.roundActive) return;
            if (document.getElementById('targetEquation').value.trim() === "") return;
            
            parseTarget();
            state.roundActive = true;
            const now = Date.now();
            state[1].startTime = now;
            state[2].startTime = now;
            
            document.getElementById('targetEquation').classList.add('hidden-text');
            document.getElementById('visibilityHint').innerText = "Text is now hidden. Click 'Reveal' or 'Reset' to see it again.";

            disableButtons(1, false);
            disableButtons(2, false);
            document.getElementById('startBtn').disabled = true;
            document.getElementById('startBtn').innerText = "Round in Progress...";
            document.getElementById('revealBtn').disabled = false;

            timerInterval = setInterval(updateTimers, 100);
            
            updateEquationDisplay(1);
            updateEquationDisplay(2);
        }

        function updateTimers() {
            const now = Date.now();
            [1, 2].forEach(num => {
                if (!state[num].locked) {
                    const elapsed = now - state[num].startTime;
                    document.getElementById(`timer${num}`).innerText = formatTime(elapsed);
                }
            });
        }

        function formatTime(ms) {
            const seconds = Math.floor(ms / 1000);
            const tenth = Math.floor((ms % 1000) / 100);
            const m = Math.floor(seconds / 60).toString().padStart(2, '0');
            const s = (seconds % 60).toString().padStart(2, '0');
            return `${m}:${s}.${tenth}`;
        }

        function lockIn(teamNum) {
            state[teamNum].locked = true;
            state[teamNum].finalTime = Date.now() - state[teamNum].startTime;
            document.getElementById(`timer${teamNum}`).innerText = formatTime(state[teamNum].finalTime);
            document.getElementById(`lockOverlay${teamNum}`).classList.remove('hidden');
            disableButtons(teamNum, true);

            updateEquationDisplay(teamNum);

            if (state[1].locked && state[2].locked) {
                clearInterval(timerInterval);
            }
        }

        function disableButtons(teamNum, disabled) {
            const buttons = document.querySelectorAll(`.team${teamNum}-btn`);
            buttons.forEach(b => b.disabled = disabled);
        }

        function parseTarget() {
            const input = document.getElementById('targetEquation').value;
            try {
                const clean = input.replace(/\s+/g, '');
                
                let aMatch = clean.match(/^y=([^x(]+)/);
                state.target.a = aMatch ? parseFloat(aMatch[1]) : 1;
                if (clean.includes('y=-(')) state.target.a = -1;

                let hMatch = clean.match(/\(x([+-]\d*\.?\d*)\)/);
                state.target.h = hMatch ? -parseFloat(hMatch[1]) : 0;

                let kMatch = clean.match(/\^2([+-]\d*\.?\d*)$/);
                state.target.k = kMatch ? parseFloat(kMatch[1]) : 0;
            } catch (e) {
                console.error("Parsing failed, using default.");
            }
        }

        function transform(teamNum, type) {
            if (state[teamNum].locked) return;
            const s = state[teamNum];
            const factorInput = document.getElementById(`factor${teamNum}`);
            const factor = Math.max(1, parseInt(factorInput.value, 10) || 1);

            switch(type) {
                case 'up': s.k += 1; break;
                case 'down': s.k -= 1; break;
                case 'left': s.h -= 1; break;
                case 'right': s.h += 1; break;
                case 'stretch': s.a *= factor; break;
                case 'compress': s.a /= factor; break;
                case 'reflectX': s.a *= -1; break;
            }
            draw(teamNum);
        }

        function updateEquationDisplay(teamNum) {
            const { h, k, a, locked } = state[teamNum];
            const display = document.getElementById(`eq${teamNum}`);
            
            if (state.roundActive && !locked) {
                display.innerText = "y = [Hidden]";
                display.classList.add('text-gray-600');
                display.classList.remove('text-gray-500');
                return;
            }

            display.classList.remove('text-gray-600');
            display.classList.add('text-gray-500');

            let aFormatted = Math.round(a * 100) / 100;
            let aStr = aFormatted === 1 ? "" : aFormatted === -1 ? "-" : aFormatted.toString();
            let hStr = h === 0 ? "x" : `(x ${h > 0 ? '-' : '+'} ${Math.abs(h)})`;
            let kStr = k === 0 ? "" : ` ${k > 0 ? '+' : '-'} ${Math.abs(k)}`;
            display.innerText = `y = ${aStr}${hStr}²${kStr}`;
        }

        function revealTarget() {
            if (state.target.active) return;
            
            state.target.active = true;
            const input = document.getElementById('targetEquation');
            const area = document.getElementById('revealArea');
            const text = document.getElementById('revealedText');
            
            text.innerText = "Target: " + (input.value || "y = x²");
            area.classList.remove('hidden');
            input.classList.remove('hidden-text');
            
            clearInterval(timerInterval);
            
            [1, 2].forEach(num => {
                const team = state[num];
                const target = state.target;
                
                const matches = (Math.abs(team.h - target.h) < 0.01) && 
                              (Math.abs(team.k - target.k) < 0.01) && 
                              (Math.abs(team.a - target.a) < 0.01);
                
                if (matches) {
                    state[num].score++;
                    document.getElementById(`score${num}`).innerText = state[num].score;
                    document.getElementById(`celebrate${num}`).classList.remove('hidden');
                    launchFireworks(num);
                }
                draw(num);
            });
            
            document.getElementById('revealBtn').disabled = true;
        }

        function resetScores() {
            state[1].score = 0;
            state[2].score = 0;
            document.getElementById('score1').innerText = "0";
            document.getElementById('score2').innerText = "0";
        }

        function resetAll() {
            clearInterval(timerInterval);
            state.roundActive = false;
            state.target.active = false;
            
            const targetInput = document.getElementById('targetEquation');
            targetInput.classList.remove('hidden-text');
            targetInput.value = ""; 
            document.getElementById('visibilityHint').innerText = "Text is visible now. It will hide when you click 'Start Round'.";

            [1, 2].forEach(num => {
                const score = state[num].score;
                state[num] = { h: 0, k: 0, a: 1, locked: false, startTime: null, finalTime: null, score: score };
                document.getElementById(`timer${num}`).innerText = "00:00.0";
                document.getElementById(`lockOverlay${num}`).classList.add('hidden');
                document.getElementById(`celebrate${num}`).classList.add('hidden');
                document.getElementById(`factor${num}`).value = "2";
                fwParticles[num] = [];
                draw(num);
                disableButtons(num, true);
            });

            document.getElementById('startBtn').disabled = false;
            document.getElementById('startBtn').innerText = "Start Round";
            document.getElementById('revealBtn').disabled = false;
            document.getElementById('revealArea').classList.add('hidden');
        }

        window.onload = init;
    </script>
</body>
</html>
